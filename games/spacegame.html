<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Star Destroyer</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: black;
    height: 100%;
    width: 100%;
    touch-action: none;
  }
  canvas {
    display: block;
    width: 100vw;
    height: 100vh;
  }

  #backBtn {
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: #444;
    padding: 12px 20px;
    border-radius: 10px;
    font-size: 16px;
    color: white;
    border: none;
    cursor: pointer;
  }
  #backArrow {
    display: none;
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: #444;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    color: white;
    cursor: pointer;
  }
  @media (max-width: 600px) {
    #backBtn { display: none; }
    #backArrow { display: flex; }
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<button id="backBtn" onclick="window.location.href='games.html'">← Back to Games</button>
<div id="backArrow" onclick="window.location.href='games.html'">⬅️</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// --- Game State ---
let player = { x: canvas.width / 2, y: canvas.height - 80, size: 25, color: "#0ff" };
let bullets = [];
let enemies = [];
let stars = [];
let score = 0;
let highScore = localStorage.getItem("starDestroyerHighScore") || 0;
let lastSpawn = 0;
let difficulty = 1;

// --- Helpers ---
function random(min, max) { return Math.random() * (max - min) + min; }

// --- Background Stars ---
for (let i = 0; i < 100; i++) {
  stars.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, size: Math.random() * 2 });
}

function drawStars() {
  ctx.fillStyle = "white";
  stars.forEach(star => {
    ctx.fillRect(star.x, star.y, star.size, star.size);
    star.y += 1;
    if (star.y > canvas.height) {
      star.y = 0;
      star.x = Math.random() * canvas.width;
    }
  });
}

// --- Player ---
function drawPlayer() {
  ctx.fillStyle = player.color;
  ctx.beginPath();
  ctx.moveTo(player.x, player.y - player.size);
  ctx.lineTo(player.x - player.size, player.y + player.size);
  ctx.lineTo(player.x + player.size, player.y + player.size);
  ctx.closePath();
  ctx.fill();
}

// --- Enemies ---
function spawnEnemy() {
  let size = random(20, 40);
  enemies.push({
    x: random(size, canvas.width - size),
    y: -size,
    size: size,
    speed: random(2, 4 + difficulty),
    color: "hsl(" + Math.random() * 360 + ", 80%, 60%)"
  });
}

function drawEnemies() {
  enemies.forEach(e => {
    ctx.fillStyle = e.color;
    ctx.beginPath();
    ctx.arc(e.x, e.y, e.size, 0, Math.PI * 2);
    ctx.fill();
  });
}

// --- Bullets ---
function drawBullets() {
  ctx.fillStyle = "#fff";
  bullets.forEach(b => {
    ctx.fillRect(b.x - 2, b.y, 4, 12);
  });
}

// --- Score ---
function drawScore() {
  ctx.fillStyle = "#fff";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 10, 30);
  ctx.fillText("High Score: " + highScore, 10, 60);
}

// --- Update Loop ---
function update() {
  // Bullets
  bullets.forEach((b, i) => {
    b.y -= 10;
    if (b.y < 0) bullets.splice(i, 1);
  });

  // Enemies
  enemies.forEach((e, i) => {
    e.y += e.speed;
    if (e.y > canvas.height) enemies.splice(i, 1);
    // Collision with player
    let dx = e.x - player.x;
    let dy = e.y - player.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    if (dist < e.size + player.size) {
      resetGame();
    }
  });

  // Bullet collisions
  bullets.forEach((b, bi) => {
    enemies.forEach((e, ei) => {
      let dx = b.x - e.x;
      let dy = b.y - e.y;
      let dist = Math.sqrt(dx * dx + dy * dy);
      if (dist < e.size) {
        enemies.splice(ei, 1);
        bullets.splice(bi, 1);
        score++;
        if (score % 10 === 0) difficulty += 0.5;
        if (score > highScore) {
          highScore = score;
          localStorage.setItem("starDestroyerHighScore", highScore);
        }
      }
    });
  });
}

// --- Reset ---
function resetGame() {
  enemies = [];
  bullets = [];
  difficulty = 1;
  score = 0;
  player.x = canvas.width / 2;
  player.y = canvas.height - 80;
}

// --- Main Loop ---
let lastTime = 0;
function loop(timestamp) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawStars();
  if (timestamp - lastSpawn > 1000 - Math.min(800, difficulty * 50)) {
    spawnEnemy();
    lastSpawn = timestamp;
  }
  drawPlayer();
  drawEnemies();
  drawBullets();
  drawScore();
  update();
  requestAnimationFrame(loop);
}

// --- Controls ---
let shooting = false;
function shoot() {
  bullets.push({ x: player.x, y: player.y - player.size });
}
canvas.addEventListener("touchstart", e => {
  let touch = e.touches[0];
  player.x = touch.clientX;
  player.y = touch.clientY;
  shoot();
});
canvas.addEventListener("touchmove", e => {
  let touch = e.touches[0];
  player.x = touch.clientX;
  player.y = touch.clientY;
});
window.addEventListener("keydown", e => {
  if (e.code === "Space") shoot();
  if (e.code === "ArrowLeft") player.x -= 20;
  if (e.code === "ArrowRight") player.x += 20;
});

// --- Start ---
requestAnimationFrame(loop);
</script>
</body>
</html>
